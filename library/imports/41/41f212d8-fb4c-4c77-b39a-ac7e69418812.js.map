{"version":3,"sources":["..\\..\\..\\..\\..\\assets\\Script\\Game/assets\\Script\\Game\\RemoteGameScene.js"],"names":["o0","require","o0CC","o0Game","cc","Class","extends","properties","remoteUINode","remoteUIAddress","isHost","webSocket","id","connectionIdToSnakeId","processData","event","data","serverData","JSON","parse","snakeNode","getChildByName","snakeScript","addSnake","name","skin","snake","node","newSnakePosition","randomInCircle2","playGround","radius","head","x","y","snakeControl","getComponent","setTargetVector","Vector2","setTargetSpeeding","childrenCount","foodNode","log","director","getCollisionManager","enabled","close","snakes","Array","i","children","isValid","length","snakeData","playerSnake","playerInput","setScore","rotation","snakeControlScript","remotePosition","_key","active","destroy","foods","food","foodData","newFood","addScriptNode","score","generatePlayerSnake","playerName","playerSkin","send","jsonData","stringify","self","setTimeout","readyState","WebSocket","OPEN","console","onLoad","_super","Node","addChild","setGroup","GroupIndex","UI","anchorX","anchorY","width","height","color","Color","fontSize","horizontalAlign","Label","HorizontalAlign","LEFT","verticalAlign","VerticalAlign","TOP","string","respawnButton","o0ClickEvent","push","start","err","onopen","onmessage","onerror","onclose","update","dt","canvas","remoteUIAddressColor","snakeIdToConnectionId","key","snakesData","body","foodsData","playerControl","targetVector","isSpeeding","generateAISnake","_onPreDestroy"],"mappings":"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","file":"RemoteGameScene.js","sourceRoot":"..\\..\\..\\..\\..\\assets\\Script\\Game","sourcesContent":["var o0 = require('o0');\r\nvar o0CC = require('o0CC');\r\nvar o0Game = require('o0Game');\r\n\r\ncc.Class({\r\n    extends: require('GameScene'),\r\n\r\n    properties: {\r\n        remoteUINode:null,\r\n        remoteUIAddress:null,\r\n        isHost:false,\r\n        webSocket:null,\r\n        id:null,\r\n        connectionIdToSnakeId:[],\r\n    },\r\n\r\n    processData:function(event){\r\n        if(typeof(event.data) != \"string\"){\r\n            return;\r\n        }\r\n        //cc.log(event.data);\r\n        var serverData = JSON.parse(event.data);\r\n        var data = serverData['data'];\r\n        if(serverData['id']!=null){\r\n            this.id = serverData['id'];\r\n        }\r\n        if(this.isHost){\r\n            //cc.log(event.data);\r\n            if(serverData['fromId'] != null\r\n                && data != null\r\n                && data['name'] != null\r\n                && data['skin'] != null){\r\n                if(this.connectionIdToSnakeId[serverData['fromId']] == null || this.snakeNode.getChildByName(this.connectionIdToSnakeId[serverData['fromId']] == null)){\r\n                    var snakeScript = this.addSnake('Snake','LocalControl');\r\n                    snakeScript.name = data['name'];\r\n                    snakeScript.skin = data['skin'];\r\n                    snake = snakeScript.node;\r\n                    var newSnakePosition = o0.randomInCircle2(this.playGround.radius*2);\r\n                    snakeScript.head.x = newSnakePosition.x;\r\n                    snakeScript.head.y = newSnakePosition.y;\r\n                    this.connectionIdToSnakeId[serverData['fromId']] = snake.name;\r\n                }\r\n            }\r\n            if(serverData['fromId'] != null\r\n                && data != null\r\n                && data['vector'] != null\r\n                && data['vector']['x'] != null\r\n                && data['vector']['y'] != null\r\n                && data['speeding'] != null\r\n                && this.connectionIdToSnakeId[serverData['fromId']] != null){\r\n                var snake = this.snakeNode.getChildByName(this.connectionIdToSnakeId[serverData['fromId']]);\r\n                if(snake != null){\r\n                    var snakeControl = snake.getComponent('Snake').head.getComponent('LocalControl');\r\n                    if(snakeControl!=null){\r\n                        snakeControl.setTargetVector(new o0.Vector2(data['vector']['x'],data['vector']['y']));\r\n                        snakeControl.setTargetSpeeding(data['speeding']);\r\n                    }\r\n                }\r\n            }\r\n        }else{\r\n            if(serverData['host']!=null){\r\n                if(serverData['host'] == true){\r\n                    if(this.snakeNode.childrenCount == 0 && this.foodNode.childrenCount == 0){\r\n                        cc.log('Become Host');\r\n                        this.isHost = true;\r\n                        cc.director.getCollisionManager().enabled = true;//碰撞检测\r\n                    }else{\r\n                        if(this.webSocket!=null){\r\n                            this.webSocket.close();\r\n                            this.webSocket = null;\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n            if(data != null){\r\n                //cc.log(data);\r\n                if(data['snake'] != null){\r\n                    //cc.log('o0data');\r\n                    var snakes = new Array();\r\n                    for(var i = 0;i<this.snakeNode.childrenCount;++i){\r\n                        var snake = this.snakeNode.children[i];\r\n                        if(snake.isValid == true)\r\n                            snakes[snake.name] = snake;\r\n                        //cc.log('0: '+snake.name);\r\n                    }\r\n\r\n                    for(var i = 0;i<data['snake'].length;++i){\r\n                        var snakeData = data['snake'][i];\r\n                        if(snakeData!=null\r\n                            && snakeData['id']!=null\r\n                            && snakeData['score']!=null\r\n                            && snakeData['position']!=null\r\n                            && snakeData['rotation']!=null\r\n                            && snakeData['skin']!=null){\r\n                            //cc.log('1: '+snakeData['id']);\r\n                            var snake = snakes[snakeData['id']];\r\n                            delete snakes[snakeData['id']];\r\n                            //cc.log('l: '+snakeData['id']);\r\n                            if(snake == null){\r\n                                //cc.log('cr: '+snakeData['id']);\r\n                                var snakeScript;\r\n                                if(snakeData['cid']!=null && snakeData['cid'] == this.id){\r\n                                    this.playerSnake = this.addSnake('RemoteSnake','RemoteControl',this.playerInput);\r\n                                    snakeScript = this.playerSnake;\r\n                                }else{\r\n                                    snakeScript = this.addSnake('RemoteSnake','RemoteControl');\r\n                                }/** */\r\n                                //snakeScript = this.addSnake('RemoteSnake','RemoteControl');\r\n                                if(snakeData['name']!=null){\r\n                                    snakeScript.name = snakeData['name'];\r\n                                }\r\n                                snake = snakeScript.node;\r\n                                snake.name = snakeData['id'];\r\n                                //cc.log('fcr: '+snakeData['id']);\r\n\r\n                                snakeScript.head.x = snakeData['position'].x;\r\n                                snakeScript.head.y = snakeData['position'].y;\r\n                                snakeScript.skin = snakeData['skin'];\r\n                            }\r\n                            //cc.log('o0data2');\r\n                            \r\n                            var snakeScript = snake.getComponent('Snake');\r\n                            snakeScript.setScore(snakeData['score']);\r\n                            snakeScript.head.rotation = snakeData['rotation'];/** */\r\n                            var snakeControlScript = snakeScript.head.getComponent('RemoteControl');\r\n                            snakeControlScript.remotePosition = new o0.Vector2(snakeData['position'].x,snakeData['position'].y);\r\n\r\n                            //cc.log(snakeScript.head.rotation);\r\n                        }\r\n                    }\r\n                    \r\n                    for(var _key in snakes){\r\n                        if(snakes[_key] != null && snakes[_key].active == true && snakes[_key].isValid){\r\n                            //cc.log('d: '+_key);\r\n                            snakes[_key].active = false;\r\n                            snakes[_key].destroy();\r\n                        }\r\n                    }/** */\r\n                }    \r\n                \r\n                \r\n                if(data['food'] != null){\r\n                    //cc.log('o0data');\r\n                    var foods = new Array();\r\n                    for(var i = 0;i<this.foodNode.childrenCount;++i){\r\n                        var food = this.foodNode.children[i];\r\n                        if(food.isValid == true)\r\n                            foods[food.name] = food;\r\n                        //cc.log('0: '+snake.name);\r\n                    }\r\n\r\n                    for(var i = 0;i<data['food'].length;++i){\r\n                        var foodData = data['food'][i];\r\n                        if(foodData!=null\r\n                            && foodData['id']!=null\r\n                            && foodData['score']!=null\r\n                            && foodData['position']!=null){\r\n                            //cc.log('1: '+snakeData['id']);\r\n                            var food = foods[foodData['id']];\r\n                            delete foods[foodData['id']];\r\n                            //cc.log('l: '+snakeData['id']);\r\n                            if(food == null){                                \r\n                                var newFood = o0CC.addScriptNode(this.foodNode,'Food',-100);\r\n                                newFood.node.x = foodData['position'].x;\r\n                                newFood.node.y = foodData['position'].y;\r\n                                newFood.score = foodData['score'];\r\n                                newFood.node.name = foodData['id'];\r\n                            }\r\n                        }\r\n                    }\r\n                    \r\n                    for(var _key in foods){\r\n                        if(foods[_key] != null && foods[_key].active == true && foods[_key].isValid){\r\n                            //cc.log('d: '+_key);\r\n                            foods[_key].active = false;\r\n                            foods[_key].destroy();\r\n                        }\r\n                    }/** */\r\n                }  \r\n\r\n\r\n            }   \r\n\r\n        }   \r\n    },\r\n\r\n\r\n    generatePlayerSnake:function(data){\r\n        if(this.isHost == true){\r\n            this.playerSnake = this.addSnake('Snake','LocalControl',this.playerInput);\r\n            this.playerSnake.name = this.playerName;\r\n            this.playerSnake.skin = this.playerSkin;\r\n            var newSnakePosition = o0.randomInCircle2(this.playGround.radius*2);\r\n            this.playerSnake.head.x = newSnakePosition.x;\r\n            this.playerSnake.head.y = newSnakePosition.y;\r\n        }else{\r\n            this.send({'name':this.playerName,\r\n                'skin':this.playerSkin});/** */\r\n        }\r\n    },\r\n\r\n    send:function(data){\r\n        var jsonData = JSON.stringify(data);\r\n        //cc.log(jsonData);\r\n        var self = this;\r\n        setTimeout(function () {\r\n            if (self.webSocket !=null && self.webSocket.readyState === WebSocket.OPEN) {\r\n                self.webSocket.send(jsonData);\r\n            }\r\n            else {\r\n                console.log(\"WebSocket instance wasn't ready...\");\r\n            }\r\n        }, 3);\r\n    },\r\n\r\n    onLoad: function () {\r\n        this._super();\r\n        var self = this;\r\n        \r\n        cc.director.getCollisionManager().enabled = false;//碰撞检测\r\n\r\n        this.remoteUINode = new cc.Node();\r\n        this.node.addChild(this.remoteUINode,10);\r\n\r\n        this.remoteUIAddress = o0CC.addScriptNode(this.remoteUINode,'cc.Label',10);\r\n        o0CC.setGroup(this.remoteUIAddress,o0Game.GroupIndex.UI);\r\n        this.remoteUIAddress.node.anchorX = 0;\r\n        this.remoteUIAddress.node.anchorY = 1;\r\n        this.remoteUIAddress.node.x = 0;\r\n        this.remoteUIAddress.node.y = 0;\r\n        this.remoteUIAddress.node.width = 150;\r\n        this.remoteUIAddress.node.height = 30;\r\n        this.remoteUIAddress.node.color = new cc.Color(255,255,255);\r\n        this.remoteUIAddress.fontSize = 20;\r\n        this.remoteUIAddress.horizontalAlign = cc.Label.HorizontalAlign.LEFT;\r\n        this.remoteUIAddress.verticalAlign = cc.Label.VerticalAlign.TOP;\r\n        this.remoteUIAddress.string = 'testAddress';\r\n        \r\n        this.respawnButton.o0ClickEvent.push(function () {\r\n            self.generatePlayerSnake();\r\n        });\r\n        \r\n        //this.remoteEventDataList = new Array();\r\n    },\r\n    \r\n\r\n\r\n    start:function(){\r\n        this._super();\r\n        var self = this;\r\n        \r\n        //this.webSocket = new WebSocket('ws://'+this.remoteUIAddress.string);\r\n        try {\r\n            this.webSocket = new WebSocket('ws://'+this.remoteUIAddress.string);\r\n         }\r\n         catch(err){\r\n            self.webSocket = null;\r\n            if(self.node!=null && self.node.active == true){\r\n                self.node.active = false;\r\n                self.node.destroy();\r\n            }\r\n         }\r\n        this.webSocket.onopen = function (event) {\r\n            self.generatePlayerSnake();\r\n            //this.send([1,1,2,3]);\r\n            console.log(\"Send Text WS was opened.\");\r\n        };\r\n        this.webSocket.onmessage = function (event) {\r\n            if(self.node!=null && self.node.isValid){\r\n                self.processData(event);\r\n            }\r\n        };\r\n        this.webSocket.onerror = function (event) {\r\n            self.webSocket = null;\r\n            if(self.node!=null && self.node.active == true){\r\n                self.node.active = false;\r\n                self.node.destroy();\r\n            }\r\n            console.log(\"Send Text fired an error\");\r\n        };\r\n        this.webSocket.onclose = function (event) {\r\n            self.webSocket = null;\r\n            if(self.node!=null && self.node.active == true){\r\n                self.node.active = false;\r\n                self.node.destroy();\r\n            }\r\n            console.log(\"WebSocket instance closed.\");\r\n        };\r\n\r\n        //this.playerSnake = this.addSnake('Snake','LocalControl','SnakeMouseInput');\r\n        //this.playerSnake.name = this.playerName;\r\n        this.generatePlayerSnake();\r\n    },\r\n\r\n\r\n\r\n    update: function (dt) {\r\n        this._super();\r\n\r\n        this.remoteUINode.x = -this.canvas.node.width/2 + 10;\r\n        this.remoteUINode.y = this.canvas.node.height/2 - 10;\r\n\r\n\r\n\r\n        var remoteUIAddressColor;\r\n        if(this.isHost){\r\n            remoteUIAddressColor = new cc.Color(255,255,255);\r\n        }else{\r\n            remoteUIAddressColor = new cc.Color(0,255,0);\r\n        }\r\n        this.remoteUIAddress.node.color = remoteUIAddressColor;\r\n\r\n        if(this.webSocket!=null){\r\n            if(this.isHost){\r\n                var snakeIdToConnectionId = [];\r\n                for(var key in this.connectionIdToSnakeId){\r\n                    snakeIdToConnectionId[this.connectionIdToSnakeId[key]] = key;\r\n                }\r\n\r\n                var snakesData = new Array();\r\n                for(var i =0;i< this.snakeNode.childrenCount;++i){\r\n                    if(this.snakeNode.children[i] == null || this.snakeNode.children[i].isValid == false){\r\n                        continue;\r\n                    }\r\n                    var snake = this.snakeNode.children[i].getComponent('Snake');\r\n                    if(snake == null){\r\n                        continue;\r\n                    }\r\n\r\n                    var snakeData;\r\n                    if(snakeIdToConnectionId[this.snakeNode.children[i].name] == null){\r\n                        snakeData = {'id':this.snakeNode.children[i].name,\r\n                        'name':snake.name,\r\n                        'score':snake.score,\r\n                        'position':{\"x\":snake.body[0].x,\"y\":snake.body[0].y},\r\n                        'rotation':snake.body[0].rotation,\r\n                        'skin':snake.skin};\r\n                    }else{\r\n                        snakeData = {'id':this.snakeNode.children[i].name,\r\n                        'cid':snakeIdToConnectionId[this.snakeNode.children[i].name],//client id,player id\r\n                        'name':snake.name,\r\n                        'score':snake.score,\r\n                        'position':{\"x\":snake.body[0].x,\"y\":snake.body[0].y},\r\n                        'rotation':snake.body[0].rotation,\r\n                        'skin':snake.skin};\r\n                        delete snakeIdToConnectionId[this.snakeNode.children[i].name];\r\n                    }\r\n                    snakesData.push(snakeData);\r\n                }\r\n\r\n                for(var key in snakeIdToConnectionId){\r\n                    delete this.connectionIdToSnakeId[snakeIdToConnectionId[key]];\r\n                }\r\n\r\n\r\n                var foodsData = new Array();\r\n                for(var i =0;i< this.foodNode.childrenCount;++i){\r\n                    if(this.foodNode.children[i] == null || this.foodNode.children[i].isValid == false){\r\n                        continue;\r\n                    }\r\n                    var food = this.foodNode.children[i].getComponent('Food');\r\n                    if(food == null){\r\n                        continue;\r\n                    }\r\n\r\n                    foodsData.push({'id':this.foodNode.children[i].name,\r\n                    'score':food.score,\r\n                    'position':{\"x\":food.node.x,\"y\":food.node.y}});\r\n                }\r\n\r\n                this.send({'snake':snakesData,'food':foodsData});/** */\r\n            }else{\r\n                if(this.playerSnake != null && this.playerSnake.node != null){\r\n                    var playerControl = this.playerSnake.body[0].getComponent('LocalControl');\r\n                    var data = {'vector':playerControl.targetVector,\r\n                    'speeding':playerControl.isSpeeding};\r\n                    this.send(data);\r\n                }/** */\r\n            }/** */\r\n        }/** */\r\n\r\n        if(this.isHost){\r\n            this.generateAISnake();\r\n        }\r\n    },\r\n    _onPreDestroy:function(){\r\n        this._super();\r\n        if(this.webSocket!=null){\r\n            this.webSocket.close();\r\n            this.webSocket = null;\r\n        }\r\n    },\r\n});"]}